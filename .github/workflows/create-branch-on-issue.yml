name: Create Branch on Issue

on:
  issues:
    types: [assigned]

jobs:
  create-branch:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Extract branch name from issue body
        env:
          ISSUE_BODY: ${{ github.event.issue.body }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
        run: |
          echo "üìù Issue Body: $ISSUE_BODY"

          # Category Ï∂îÏ∂ú (Ïòà: "feat (new feature)" ‚Üí feat)
          CATEGORY=$(echo "$ISSUE_BODY" | grep -i '^Category:' | sed -E 's/.*Category:\s*([a-z]+).*/\1/i')
          CATEGORY=${CATEGORY:-chore}

          # Ï†úÎ™©ÏùÑ slugÎ°ú Î≥ÄÌôò
          SLUG=$(echo "$ISSUE_TITLE" \
            | sed -E 's/^\[[^]]+\]\s*//' \
            | tr '[:upper:]' '[:lower:]' \
            | sed -E 's/[^a-z0-9]+/-/g' \
            | sed -E 's/^-+|-+$//g')

          BRANCH_NAME="${CATEGORY}/issue-${ISSUE_NUMBER}/${SLUG}"
          echo "üîß Creating branch: $BRANCH_NAME"

          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"

          git fetch origin
          git checkout -b "$BRANCH_NAME" origin/main
          git push origin "$BRANCH_NAME"
