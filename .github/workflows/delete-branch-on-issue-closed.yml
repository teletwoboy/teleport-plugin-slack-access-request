name: Delete Branch on Issue Closed

on:
  issues:
    types: [closed]

jobs:
  delete-branch:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: read

    steps:
      - name: Determine branch name
        env:
          ISSUE_BODY: ${{ github.event.issue.body }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          CATEGORY=$(echo "$ISSUE_BODY" | grep -i '^Category:' | sed -E 's/.*Category:\s*([a-z]+).*/\1/i')
          CATEGORY=${CATEGORY:-chore}

          SLUG=$(echo "$ISSUE_TITLE" \
            | tr '[:upper:]' '[:lower:]' \
            | sed -E 's/[^a-z0-9]+/-/g' \
            | sed -E 's/^-+|-+$//g')

          BRANCH_NAME="${CATEGORY}/issue-${ISSUE_NUMBER}/${SLUG}"
          echo "ðŸ—‘ Deleting branch: $BRANCH_NAME"

          # ë¸Œëžœì¹˜ ì‚­ì œ (GitHub API ì‚¬ìš©)
          gh api -X DELETE "repos/${{ github.repository }}/git/refs/heads/${BRANCH_NAME}"
